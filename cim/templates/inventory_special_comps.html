<!-- Links to 'base_logged_in.html' as a base template file (which inherits from the base.html) -->
{% extends 'base_logged_in.html' %}

<!-- Jinja2 Template Block for Head of Webpage -->
{% block head %}

{% endblock %}

<!-- Jinja2 Template Block for Body of Webpage -->
{% block body %}

<!-- scripts to run the Edit modals -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<!-- add new form -->
<div class="intro-div">
    <h4>Inventory - CPUs (Special Components)</h4>
	<p>Each CPU is a special component with a unique serial number, and can only be stored in a single location at a single site.</p>
	<p>A special component is considered 'free' if it has not yet been assigned to be assembled into a particular product.</p> 
</div>


<div id="data-add" class="border">

	<div class="text-center"><h6>Order New CPUs (Special Components)</h6></div>

	<p class="text-center">If new CPUs (special components with unique serial numbers) need to be added to the inventory, use this form. Newly added CPUs will have unique serial numbers generated upon creation.</p>

	<form id="add-special-components" action="">

		<div class="inner-div text-center">

			<label>Add new Special Components to Inventory: </label>

			<label for="new_reg_comp_part_number">Part Number: </label>
			<input type="number" min="10000" max="99998" class='m-1' name="new_reg_comp_part_number" id="new_reg_comp_part_number" placeholder="Part Number" required>

			<select class="custom-select m-1" id="new_site" required>
							<option selected>CPU Type: </option>
							{% for sc_category in special_components_catalog.CPU %}
						    	<option>{{sc_category}}</option>
						    {% endfor %}
						</select>

			<select class="custom-select m-1" id="new_reg_comp_site" required>
				<option selected>Select Site: </option>
				{% for site in sites %}
					<option>{{site.site_name}}</option>
				{% endfor %}
			</select>

			<label for="new_reg_comp_quantity">Order Quantity: </label>
			<input type="number" min="1" max="50" class='m-1' name="new_reg_comp_quantity" id="new_reg_comp_quantity" placeholder="#" required>
		
			<input type="button" class="btn-sm btn-success m-1" value="Order New Special Components" onclick=addData() >
		</div>

		<div class="inner-div text-center">Note that all ordered components will be placed in the Receiving Department (Room 0, Shelf 0) at the selected site.</div>
        
	</form>
</div>



<div id="data-filtering" class="mb-0">

	<div class="text-center"><h6>Filter Existing CPUs (Special Components)</h6></div>

	<form id="existing-reg-comp-data-filter" action="">

		<div class="inner-div text-center">

			<label for="new_reg_comp_part_number">Serial Number: </label>
			<input type="number" min="1000000000" max="9999999998" class='m-1' name="existing_reg_comp_serial_number" id="existing_reg_comp_serial_number" placeholder="1234567890">	

			<label for="new_reg_comp_part_number">Part Number: </label>
			<input type="number" min="10000" max="99998" class='m-1' name="existing_reg_comp_part_number" id="existing_reg_comp_part_number" placeholder="12345">		

			<select class="custom-select m-1" id="existing_reg_comp_site">
				<option selected>Select Site: </option>
				{% for site in sites %}
					<option>{{site.site_name}}</option>
				{% endfor %}
			</select>

			<label for="new_reg_comp_room_number">Room Number: </label>
			<input type="number" min="0" max="99" class='m-1' name="existing_reg_comp_room_number" id="existing_reg_comp_room_number" placeholder="99">

			<label for="new_reg_comp_shelf_number">Shelf Number: </label>
			<input type="number" min="0" max="99" class='m-1' name="existing_reg_comp_shelf_number" id="existing_reg_comp_shelf_number" placeholder="99">

			<label for="sc_is_free">Is Free: </label>
			<input type="checkbox" name="sc_is_free" id="sc_is_free">
		
			<input type="button" class="btn-sm btn-primary m-1" value="Filter" onclick=filterData() >
			<input type="button" class="btn-sm btn-primary m-1" value="Clear Filters" onclick=clearFilters() >

			<div>Note that each shelf in each room can store multiple special components, each with a unique serial number.</div>
		</div>
        
	</form>
</div>



    <div class="col-8">
      <!-- Special Components Results -->

      <div id="results">

      		<div class="border p-1 pt-2" style="height: 50vh; overflow-y: scroll;">

				<table class="table table-striped">
					<tr>
						<th>Serial Number</th>
						<th>Part Number</th>
						<th>Is Free</th>
						<th>Site / Location</th>
						<th>Edit Details</th>
						<th>Delete</th>
						</tr>
						{% for special_component in special_components %}
							<tr>
								<td>{{special_component.sc_sn}}</td>
								<td>{{special_component.sc_pn}}</td>
								<td> {% if special_component.sc_is_free %} Yes {% else %} No {% endif %}</td>
								<td>
									{% for site in sites %}
										{% if site.site_id == special_component.sc_location.location_site_id %}
											{{site.site_name}}  
										{% endif %}
									{% endfor %}
									/ Room {{special_component.sc_location.location_room_number}}, Shelf {{special_component.sc_location.location_shelf_number}}
								</td>
									
								<!-- <th><button class="btn-sm btn-warning">Edit</button></th> -->
								<th><button type="button" 
									class="btn-sm btn-warning" 
									data-toggle="modal" 
									data-target="#editSpecialComponent" 
									data-spec-comp-part-number="{{special_component.sc_pn}}"
									data-spec-comp-site-name="{% for site in sites %}{% if special_component.sc_location.location_site_id %}{{site.site_name}}{% endif %}{% endfor %}" 
									data-spec-comp-room-number="{{special_component.sc_location.location_room_number}}" 
									data-spec-comp-shelf-number="{{special_component.sc_location.location_shelf_number}}" 
									data-spec-comp-is-free="{{special_component.sc_is_free}}" 
									data-title="Edit Special Component ID {{special_component.sc_sn}}">Edit</button></th>

								<td><button class="btn-sm btn-danger">Delete</button></td>
						</tr>
					{% endfor %}
				</table>
			</div>
		</div>
    </div>

</div>


<!-- Modal popup for special component Edit feature -->
<div id="editSpecialComponent" class="modal fade" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <form>
                    <div class="modal-header">
                        <h5 class="modal-title">Modal Window</h5>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>
                    <div class="modal-body">  

                    	<div class="form-group p-1">
                            <label class="control-label" >Part Number:</label>
                            <input type="number" min="0" max="999" id="spec-comp-edit-part-number" class="form-control"  required>
                        </div> 

						<div class="form-group p-1">
							<label class="control-label" >Site:</label>
							<select class="custom-select" id="spec-comp-edit-site" required>
							<option selected>Select Site: </option>
								{% for site in sites %}
							    	<option>{{site.site_name}}</option>
							    {% endfor %}
							</select>
						</div>                    	

                        <div class="form-group p-1">
                            <label class="control-label" >Room Number:</label>
                            <input type="number" min="0" max="999" id="spec-comp-edit-room-number" class="form-control"  required>
                        </div>   

                        <div class="form-group p-1">
                            <label class="control-label" >Shelf Number:</label>
                            <input type="number" min="0" max="999" id="spec-comp-edit-shelf-number" class="form-control" required>
                        </div>  

						<div class="custom-control custom-checkbox">
							<label class="custom-control-label" for="defaultUnchecked">Is Free:  </label>
							<input type="checkbox" class="custom-control-input ml-2" id="spec-comp-edit-is-free" checked/>
							
						</div>
					
					</div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary">Update</button>
                    </div>
                </form>
            </div>
        </div>
    </div>


<script>
$(document).ready(function(){
    $("#editSpecialComponent").on("show.bs.modal", function(event){
        // Get the button that triggered the modal
        var button = $(event.relatedTarget);

        // Extract value from the custom data-* attribute
        var titleData = button.data("title");
        $(this).find(".modal-title").text(titleData);

        var partNumberData = parseInt(button.data("spec-comp-part-number"));
        $(this).find("#spec-comp-edit-part-number").val(partNumberData);

        var siteNameData = button.data("spec-comp-site-name");        
        $(this).find("#spec-comp-edit-site").val(siteNameData);

        var roomNumberData = parseInt(button.data("spec-comp-room-number"));
        $(this).find("#spec-comp-edit-room-number").val(roomNumberData);

        var shelfNumberData = parseInt(button.data("spec-comp-shelf-number"));
        $(this).find("#spec-comp-edit-shelf-number").val(shelfNumberData);

        var specialComponentIsFreeData = button.data("spec-comp-is-free");        
        $(this).find("#spec-comp-edit-is-free").val(specialComponentIsFreeData);

        
    });
});
</script>


</div>

{% endblock %}

