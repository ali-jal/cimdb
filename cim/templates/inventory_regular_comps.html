<!-- Links to 'base_logged_in.html' as a base template file (which inherits from the base.html) -->
{% extends 'base_logged_in.html' %}

<!-- Jinja2 Template Block for Head of Webpage -->
{% block head %}

{% endblock %}

<!-- Jinja2 Template Block for Body of Webpage -->
{% block body %}

<!-- scripts to run the Edit modals -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<div class="w-100">
	
<div class="intro-div">
	<h4>Inventory - Regular Components</h4>
	<p>Regular components do not have unique serial numbers and can be stored in multiple locations at each site.</p>
	<p>Note that new orders of existing components will be placed in the Receiving Department (Room 0, Shelf 0) of the selected site.</p>
</div>

<div class="row">
  	

    <div class="col-2 text-center">
      <!-- Regular Components Filter -->
      <div class="text-center"><h6>Filter Regular Components</h6></div>

      <div id="data-filtering">

      		<form id="sc-data-filter" class="form-horizontal" action="">

			<div class="form-row">
				<div class="col-sm">
					<select class="custom-select" id="rc_category" required>
						<option selected>Select Category</option>
					    <option>Case</option>
					    <option>Graphics Card (GC)</option>
					    <option>Hard Drive Disk (HDD)</option>
					    <option>Motherboard (MB)</option>
					    <option>RAM</option>
					</select>
				</div>
			</div>

			<div class="form-row">
				<div class="col-sm">
					<input type="number" name="rc_pn" id="rc_pn" placeholder="Part Number">
				</div>
			</div>

			<div class="form-row">
					<div class="col-sm">
						<select class="custom-select" id="select_sc_site" required>
							<option selected>Select Site: </option>
							{% for site in sites %}
						    	<option>{{site.site_name}}</option>
						    {% endfor %}
						</select>
					</div>
				</div>

			<div class="form-row">
				<div class="col-sm">
					<input type="number" name="sc_room" id="sc_room" placeholder="Room # (ie. 99)">
				</div>
			</div>

			<div class="form-row">
				<div class="col-sm">
					<input type="number" name="sc_shelf" id="sc_shelf" placeholder="Shelf # (ie. 99)">
				</div>
			</div>

		
			<div class="inner-div">
				<input type="button" class="btn-sm btn-primary" value="Filter" onclick=addData() >
				<input type="button" class="btn-sm btn-primary" value="Clear Filters" onclick=clearFilters() >
			</div>

			<div class='text-center'><h6>Note that each shelf in each room can store multiple regular components regardless of category or part number.</h6></div>
		</form>
	</div>


    </div>

    <div class="col-8">
      <!-- Regular Components Results -->

        <div id="results">

        	<div class="border p-1 pt-2" style="height: 35vh; overflow-y: scroll;">

        	{% for regular_component in regular_components %}
        	<div class="row">
  				<div class="col text-center border-top"> 
  					Part Number: <strong>{{regular_component.rc_pn}}</strong> - Category: <strong>{{regular_component.rc_category}}</strong>
  				</div>

  			</div>

			<div class="row">

				<div class="col d-flex flex-row">
					<p class="mt-2">Order more of component {{regular_component.rc_pn}}: </p>
					<div>
							<select class="custom-select mt-2 pl-2" id="new_rc_site" required>
							<option selected>Select Site: </option>
							{% for site in sites %}
							<option>{{site.site_name}}</option>
							{% endfor %}
							</select>
						</div>

						<div >
							<select class="custom-select mt-2" id="new_rc_site" required>
							<option selected>Select Quantity: </option>
							<option>10</option>
							<option>25</option>
							<option>50</option>
							<option>100</option>
							</select>
						</div>

						<div><button class="btn-sm btn-info m-1">Order More</button></div>
				</div>

				<div class="col d-flex flex-row-reverse"> 
  					<button class="btn-sm btn-danger">Delete All Component {{regular_component.rc_pn}}</button>

					<button type="button" 
						class="btn-sm btn-warning text-right" 
						data-toggle="modal" 
						data-target="#editRegularComponent" 
						data-reg-comp-part-number="{{regular_component.rc_pn}}"
						data-reg-comp-category="{{regular_component.rc_category}}"
						data-title="Edit Quantity of Part Number {{regular_component.rc_pn}}">Edit Details for Component {{regular_component.rc_pn}}</button>

				</div>
  			</div>

  			<div class="row">
  				
			<table class="table table-striped">
				<tr>
					<th>Site</th>
					<th>Location</th>
					<th>Quantity</th>
					<th>Edit Quantity</th>
					<th>Delete from Location</th>
				</tr>
				{% for location in regular_component.rc_locations %}
				<tr>
					<td>{% for site in sites %}{% if site.site_id == location.location_site_id %}{{site.site_name}}{% endif %}{% endfor %}</td>
					<td>Room {{location.location_room_number}}, Shelf {{location.location_shelf_number}}</td>
					<td>{{location.quantity_at_location}}</td>
					
					<th><button type="button" 
						class="btn-sm btn-warning text-right" 
						data-toggle="modal" 
						data-target="#editRegularComponentQuantity" 
						data-reg-comp-part-number="{{regular_component.rc_pn}}"
						data-reg-comp-category="{{regular_component.rc_category}}"
						data-reg-comp-site-name="{% for site in sites %}{% if location.location_site_id == site.site_id%}{{site.site_name}}{% endif %}{% endfor %}" 
						data-reg-comp-room-number="{{location.location_room_number}}" 
						data-reg-comp-shelf-number="{{location.location_shelf_number}}" 
						data-reg-comp-quantity={{location.quantity_at_location}}
						data-title="Edit Quantity of Part Number {{regular_component.rc_pn}}">Edit</button></th>

					<td><button class="btn-sm btn-danger">Delete</button></td>
				</tr>
				{% endfor %}
			</table>

  			</div>

			
			{% endfor %}

			</div>

		</div>

    </div>

    <div class="col text-center">
      <!-- Regular Components Add -->
      <div class="text-center"><h6>Order New Regular Components</h6></div>

      <p>If a new regular component (non-CPU/non unique) needs to be ordered and added to the inventory, use this form. </p>

      <div id="data-entry-div">	

			<form id="sc_entry" class="form-horizontal" action="">

				<div class="form-group row">
					<div class="inner-div">
						<label for="new_sc_pn">New Part Number: </label>
						<input type="number" name="new_sc_pn" id="new_sc_pn" min="10000" max="99998" placeholder="12345" required>
					</div>
				</div>

				<div class="form-group row">
					<div class="inner-div">
						<select class="custom-select" id="rc_category">
							<option selected>Select Category</option>
						    <option>Case</option>
						    <option>Graphics Card (GC)</option>
						    <option>Hard Drive Disk (HDD)</option>
						    <option>Motherboard (MB)</option>
						    <option>RAM</option>
						</select>
					</div>
				</div>

				<div class="form-group row">
					<div class="inner-div">
						<label for="new_rc_quantity">Order Quantity: </label>
						<input type="number" name="new_rc_quantity" id="new_rc_quantity" min="1" max="50" placeholder="17" required>
					</div>
				</div>

				<div class="form-group row">
					<div class="inner-div">
						<select class="custom-select" id="new_rc_site" required>
							<option selected>Select Site: </option>
							{% for site in sites %}
						    	<option>{{site.site_name}}</option>
						    {% endfor %}
						</select>
					</div>
				</div>


				<div class="form-group row">
					<div class="inner-div">
					<input type="button" class="btn-sm btn-success" value="Order New Regular Components" onclick=addData() >
					</div>
				</div>

				<div class="text-justify">Note that all ordered components will be placed in the Receiving Department (Room 0, Shelf 0) at the selected site.</div>
			</form>

    	</div>

    </div>

  </div>


<!-- Modal popup for regular component quantity Edit feature -->=
<div id="editRegularComponentQuantity" class="modal fade" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <form>
                    <div class="modal-header">
                        <h5 class="modal-title">Modal Window</h5>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>
                    <div class="modal-body">  

						<div class="form-group p-1">
                            <label class="control-label" >Quantity in <span id="reg-comp-edit-site"></span>, Room <span id="reg-comp-edit-room-number"></span>, Shelf <span id="reg-comp-edit-shelf-number"></span>:</label>
                            <input type="number" min="0" max="999" id="reg-comp-edit-quantity" class="form-control" required>
                        </div> 
					
					</div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary">Update</button>
                    </div>
                </form>
            </div>
        </div>
    </div>


<!-- Modal popup for regular component details Edit feature -->=
<div id="editRegularComponentQuantity" class="modal fade" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <form>
                    <div class="modal-header">
                        <h5 class="modal-title">Modal Window</h5>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>
                    <div class="modal-body">  

						<div class="form-group p-1">
                            <label class="control-label" >Part Number:</label>
                            <input type="number" min="0" max="999" id="spec-comp-edit-part-number" class="form-control"  required>
                        </div>

                        <div class="form-group p-1">
                            <label class="control-label" >Part Category:</label>
                            <input type="number" min="0" max="999" id="spec-comp-edit-part-number" class="form-control"  required>
                        </div> 
					
					</div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary">Update</button>
                    </div>
                </form>
            </div>
        </div>
    </div>


<script>
$(document).ready(function(){
    $("#editRegularComponent").on("show.bs.modal", function(event){
        // Get the button that triggered the modal
        var button = $(event.relatedTarget);

        // Extract value from the custom data-* attribute
        var titleData = button.data("title");
        $(this).find(".modal-title").text(titleData);

        var partNumberData = parseInt(button.data("reg-comp-part-number"));
        $(this).find("#reg-comp-edit-part-number").html(partNumberData);

        var siteNameData = button.data("reg-comp-site-name");        
        $(this).find("#reg-comp-edit-site").html(siteNameData);

        var roomNumberData = parseInt(button.data("reg-comp-room-number"));
        $(this).find("#reg-comp-edit-room-number").html(roomNumberData);

        var shelfNumberData = parseInt(button.data("reg-comp-shelf-number"));
        $(this).find("#reg-comp-edit-shelf-number").html(shelfNumberData);

        var regularComponentQuantityData = button.data("reg-comp-quantity");        
        $(this).find("#reg-comp-edit-quantity").val(regularComponentQuantityData);
    });
});
</script>

</div>

{% endblock %}

